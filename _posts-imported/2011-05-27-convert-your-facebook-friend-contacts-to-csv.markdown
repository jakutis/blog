---
layout: post
title: !binary |-
  Q29udmVydCB5b3VyIEZhY2Vib29rIGZyaWVuZCBjb250YWN0cyB0byBDU1Y=
wordpress_id: 95
wordpress_url: !binary |-
  aHR0cDovL3Z5dGF1dGFzLmpha3V0aXMubmFtZS8/cD05NQ==
date: 2011-05-27 23:47:49.000000000 +00:00
---
To execute this JavaScript code, <strong>you need to open <a href="https://www.facebook.com/profile.php?sk=friends">the friends list</a></strong> from your own profile. Also, do not forget to scroll down, until all friends are loaded.

When the script is finished, a pop up window with a filled text field is opened. You need to select all text, copy it to a text editor and save it with csv file extension.

<strong>Update</strong>: now randomizing the order and time in which contacts are polled.

The bookmarklet:
<a href="javascript:(function(){(function(){var shuffle,bound,screenNamesAndEmailsAndWebsites,getContacts,screenNames,fillBorn,iframe,IframeSeries,fieldsToExport,log,txt,getData,fillData,ready,warn,except,fillCityCountry,multi,contactsToCSV,fill;fieldsToExport=['First name','Last name','Second name','Birthday date','Home address','Home city','Home country','Home phone','Home phone 2','Home phone 3','Home phone 4','Cell phone','Cell phone 2','Cell phone 3','Cell phone 4','E-Mail','E-Mail 2','E-Mail 3','E-Mail 4','WWW','WWW 2','WWW 3','WWW 4','IM Skype','IM AOL','Additional info'];log=function(){};ask=function(question,initial){var answer;answer=typeof initial==='undefined'?window.confirm(question):window.prompt(question,initial);log('ask',question,initial,answer);return answer;};except=function(message){log('except',message);throw message;};warn=function(message){log('warn',message);window.alert(message);};bound=function(n,min){return n&lt;min?min:n;};shuffle=function(arr){var i,j,n,res=[];n=arr.length;for(i=0;i&lt;n;i++){j=Math.round(Math.random()*(arr.length-1));res.push(arr[j]);arr.splice(j,1);}return res;};txt=function(node){if(node.childNodes.length===0){return'';}if(typeof node.textContent!=='undefined'){return node.textContent;}if(typeof node.innerText!=='undefined'){return node.innerText;}except('cannot get text from node');};getData=function(el){var arr,e,i;try{if(el.nodeType===3){return el.data;}if(el.classList.contains('url')){return el.href;}if(el.classList.contains('fsm')||el.classList.contains('mediaRowWrapper')){el=el.firstChild;}if(el.classList.contains('uiList')){if(el.firstChild.lastChild.nodeType===1&amp;&amp;el.firstChild.lastChild.classList.contains('pls')&amp;&amp;el.firstChild.lastChild.classList.contains('inlineLabel')){arr={};for(i=0,c=el.childNodes;c[i];i++){e=c[i].lastChild.firstChild;if(typeof arr[e.data]==='undefined'){arr[e.data]=[];}if(c[i].firstChild.nodeType===3){arr[e.data].push(c[i].firstChild.data);}else{arr[e.data].push(txt(c[i].firstChild));}}}else{arr=[];for(i=0,c=el.childNodes;c[i];i++){if(c[i].firstChild.nodeType===3){arr.push(c[i].firstChild.data);}else{arr.push(txt(c[i]));}}}return arr;}}catch(ex){except('failed at'+txt(el));}return txt(el);};ready=function(w){return w.document.querySelectorAll('td.data').length&gt;0;};fillData=function(o,w){var i,data,label;data=w.document.querySelectorAll('td.data');label=w.document.querySelectorAll('th.label');if(data.length!==label.length){except('data length does not equal label length');}for(i=0;data[i];i++){if(label[i].firstChild!==null){o[label[i].firstChild.data]=getData(data[i].firstChild);}}};iframe=function(url,callback){var el;el=window.document.createElement('iframe');el.src=url;el.onload=function(){callback(el.contentWindow,function(){window.document.body.removeChild(el);});};el.height=1;el.width=1;el.style.opacity=0;window.document.body.appendChild(el);};IframeSeries={el:window.document.createElement('iframe'),load:function(url,callback){var that=this;this.el.onload=function(){callback(that.el.contentWindow);};this.el.src=url;}};window.document.body.appendChild(IframeSeries.el);fillBorn=function(w,contact){var i,lines,prefix,date,text;lines=w.document.querySelectorAll('.fbProfileBylineFragment');prefix='Born on';date=null;for(i=0;lines[i];i++){text=lines[i].childNodes[1].data;if(text.indexOf(prefix)===0){text=text.substr(prefix.length);if(!Date.parse(text)){text+=',2010';}contact.born=new Date(text);return;}}};fillCityCountry=function(line,contact){var a;a=line.split(',');if(a.length&gt;2){throw'unexpectedly many comma-separated values in address';}else if(a.length===1){contact['Home country']=a[0];}else{contact['Home city']=a[0];contact['Home country']=a[1];}};multi=function(prefix,target,source,prop){if(typeof source[prop]==='undefined'){log('no',prop);return;}source[prop].forEach(function(e,i){target[prefix+(i&gt;0?(''+(i+1)):'')]=e;});delete source[prop];};screenNames=function(contact,key,types){Object.keys(types).forEach(function(i){if(typeof contact[key]['('+i+')']!=='undefined'){if(i==='Google Talk'){contact.Email.push(contact[key]['('+i+')'][0]);}if(i==='Twitter'){contact.Website.push('http://twitter.com/'+contact[key]['(Twitter)'][0]);}else{var o=0;if(typeof contact['IM'+types[i]]==='undefined'){o++;contact['IM'+types[i]]=contact[key]['('+i+')'][0];}contact[key]['('+i+')'].slice(o).forEach(function(value){contact['Additional info']+='IM'+types[i]+':'+value+';';});}delete contact[key]['('+i+')'];}});if(Object.keys(contact[key]).length&gt;0){except('too many'+key+'defined:'+JSON.stringify(contact[key]));}delete contact[key];};screenNamesAndEmailsAndWebsites=function(contact,types){if(typeof contact.Email==='undefined'){contact.Email=[];}if(typeof contact.Website==='undefined'){contact.Website=[];}contact['Additional info']+='Facebook profile:'+contact.url[0]+';';delete contact.url;contact.Website=contact.Website.filter(function(url){if(url.substr(0,4)!=='http'){log('unknown website',url);return false;}return true;});if(typeof contact['Screen Name']!=='undefined'){screenNames(contact,'Screen Name',types);}if(typeof contact['Screen Names']!=='undefined'){screenNames(contact,'Screen Names',types);}multi('E-Mail',contact,contact,'Email');multi('WWW',contact,contact,'Website');};fill=function(w,contact){var i,d,month,day,j,found,names;try{found=false;for(i=0,c=w.document.querySelectorAll('script');c[i];i++){j=txt(c[i]).indexOf('navigation.php?id=');if(j&gt;=0){found=true;contact['Additional info']='Facebook ID:'+txt(c[i]).substring(j+'navigation.php?id='.length,txt(c[i]).indexOf('\\',j))+';';}}if(!found){except('could not find Facebook ID');}fillData(contact,w);names=contact.fullName.split(/\s/g);contact['First name']=names[0];contact['Last name']=names[names.length-1];if(names.length&gt;2){contact['Second name']=names[1];}delete contact.fullName;if(typeof contact.Address!=='undefined'){if(contact.Address.length&gt;2){except('unexpectedly long address:'+contact.Address);}else if(contact.Address.length===1){fillCityCountry(contact.Address[0],contact);delete contact.Address;}else{contact['Home address']=contact.Address[0];fillCityCountry(contact.Address[1],contact);delete contact.Address;}}if(typeof contact.Phone!=='undefined'){i=0;if(typeof contact.Phone.Mobile!=='undefined'){i++;multi('Cell phone',contact,contact.Phone,'Mobile');}if(typeof contact.Phone.Home!=='undefined'){i++;multi('Home phone',contact,contact.Phone,'Home');}if(Object.keys(contact.Phone).length!==0){except('too many phones defined:'+JSON.stringify(contact.Phone)+','+Object.keys(contact.Phone));}delete contact.Phone;}screenNamesAndEmailsAndWebsites(contact,{'Skype':'Skype','Twitter':'Twitter','AIM':'AOL','Google Talk':'Jabber','Windows Live Messenger':'MSN','Yahoo!Messenger':'Yahoo','Gadu-Gadu':'Gadu-Gadu','ICQ':'ICQ'});fillBorn(w,contact);if(typeof contact.born!=='undefined'){d=contact.born;month=d.getUTCMonth()+1;day=d.getUTCDate()+1;contact['Birthday date']=(month&lt;10?('0'+month):String(month))+'/'+(day&lt;10?('0'+day):String(day))+'/'+d.getUTCFullYear();delete contact.born;}for(i in contact){if(Object.prototype.hasOwnProperty.call(contact,i)&amp;&amp;fieldsToExport.indexOf(i)&lt;0){contact['Additional info']+=i+':'+contact[i]+';';delete contact[i];}}}catch(e){warn('Contact was not fully read:'+JSON.stringify(contact));}};contactsToCSV=function(contacts){var w,ps,csv;ps=fieldsToExport;csv=ps.join(',')+'\n';log('header',csv);contacts.forEach(function(contact){var arr;arr=[];ps.forEach(function(p){if(typeof contact[p]==='undefined'||contact[p]===''){arr.push('');}else{arr.push('&quot;'+contact[p].replace(new RegExp('&quot;','g'),'&quot;&quot;')+'&quot;');}});csv+=arr.join(',')+'\n';});w=window.open();w.document.write('&lt;textarea&gt;'+csv+'&lt;/textarea&gt;');};getContacts=function(onFinish){var contacts,o,i,c;contacts=document.querySelectorAll('.fwb');o=[];for(i=0;contacts[i];i++){if(contacts[i].classList.contains('fsl')){c={};c.url=[contacts[i].firstChild.href];c.fullName=contacts[i].firstChild.innerHTML;o.push(c);}}onFinish(o);};getContacts(function(contacts){var next,i,step,timeout;i=0;step=Number(ask('Please enter an interval(in milliseconds)to wait between each poll for contact data.No less than 200.','500'));if(step&lt;200){step=200;}timeout=20;contacts=shuffle(contacts);window.contacts=contacts;next=function(){log(i,contacts.length);if(i===contacts.length){contactsToCSV(contacts);}else{log('extracting',contacts[i].fullName,contacts[i].url[0]);IframeSeries.load(contacts[i].url[0]+(contacts[i].url[0].indexOf('profile.php')&lt;0?'?':'&amp;')+'sk=info',function(w){var j,poll;j=0;poll=function(){if(j===timeout){if(ask('Failing to find data of&quot;'+contacts[i].fullName+'&quot;.Keep trying?')){j=0;}else{fill(w,contacts[i]);i++;next();return;}}setTimeout(function(){log('poll');if(ready(w)){fill(w,contacts[i]);i++;next();log('extracted',contacts[i]);}else{j++;poll();}},bound(step*Math.random(),100));};poll();});}};next();});})()})()" id="bmlink">bookmarklet</a>

The source code:
<pre style="overflow: auto; color: #000000; background-color: khaki; font-size: 10pt; font-family: monospace;">
<span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(){</span>
  <span style="color:#000000; font-weight:bold">var</span> shuffle<span style="color:#000000">,</span> bound<span style="color:#000000">,</span> screenNamesAndEmailsAndWebsites<span style="color:#000000">,</span> getContacts<span style="color:#000000">,</span> screenNames<span style="color:#000000">,</span> fillBorn<span style="color:#000000">,</span> iframe<span style="color:#000000">,</span> IframeSeries<span style="color:#000000">,</span> fieldsToExport<span style="color:#000000">,</span> log<span style="color:#000000">,</span> txt<span style="color:#000000">,</span> getData<span style="color:#000000">,</span> fillData<span style="color:#000000">,</span> ready<span style="color:#000000">,</span> warn<span style="color:#000000">,</span> except<span style="color:#000000">,</span> fillCityCountry<span style="color:#000000">,</span> multi<span style="color:#000000">,</span> contactsToCSV<span style="color:#000000">,</span> fill<span style="color:#000000">;</span>

fieldsToExport <span style="color:#000000">= [</span><span style="color:#ff0000">'First name'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Last name'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Second name'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Birthday date'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Home address'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Home city'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Home country'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Home phone'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Home phone 2'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Home phone 3'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Home phone 4'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Cell phone'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Cell phone 2'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Cell phone 3'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Cell phone 4'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'E-Mail'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'E-Mail 2'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'E-Mail 3'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'E-Mail 4'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'WWW'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'WWW 2'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'WWW 3'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'WWW 4'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'IM Skype'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'IM AOL'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Additional info'</span><span style="color:#000000">];</span>
log <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(){};</span>
ask <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>question<span style="color:#000000">,</span> initial<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">var</span> answer<span style="color:#000000">;</span>

  answer <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">typeof</span> initial <span style="color:#000000">===</span> <span style="color:#ff0000">'undefined'</span> ? window<span style="color:#000000">.</span><span style="color:#010181">confirm</span><span style="color:#000000">(</span>question<span style="color:#000000">) :</span> window<span style="color:#000000">.</span><span style="color:#010181">prompt</span><span style="color:#000000">(</span>question<span style="color:#000000">,</span> initial<span style="color:#000000">);</span>
  <span style="color:#010181">log</span><span style="color:#000000">(</span><span style="color:#ff0000">'ask'</span><span style="color:#000000">,</span> question<span style="color:#000000">,</span> initial<span style="color:#000000">,</span> answer<span style="color:#000000">);</span>
  <span style="color:#000000; font-weight:bold">return</span> answer<span style="color:#000000">;</span>
<span style="color:#000000">};</span>
except <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>message<span style="color:#000000">) {</span>
  <span style="color:#010181">log</span><span style="color:#000000">(</span><span style="color:#ff0000">'except'</span><span style="color:#000000">,</span> message<span style="color:#000000">);</span>
  <span style="color:#000000; font-weight:bold">throw</span> message<span style="color:#000000">;</span>
<span style="color:#000000">};</span>
warn <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>message<span style="color:#000000">) {</span>
  <span style="color:#010181">log</span><span style="color:#000000">(</span><span style="color:#ff0000">'warn'</span><span style="color:#000000">,</span> message<span style="color:#000000">);</span>
  window<span style="color:#000000">.</span><span style="color:#010181">alert</span><span style="color:#000000">(</span>message<span style="color:#000000">);</span>
<span style="color:#000000">};</span>
bound <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>n<span style="color:#000000">,</span> min<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">return</span> n <span style="color:#000000">&lt;</span> min ? min <span style="color:#000000">:</span> n<span style="color:#000000">;</span>
<span style="color:#000000">};</span>
shuffle <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>arr<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">var</span> i<span style="color:#000000">,</span>j<span style="color:#000000">,</span>n<span style="color:#000000">,</span>res<span style="color:#000000">=[];</span>

  n <span style="color:#000000">=</span> arr<span style="color:#000000">.</span>length<span style="color:#000000">;</span>
  <span style="color:#000000; font-weight:bold">for</span><span style="color:#000000">(</span>i<span style="color:#000000">=</span><span style="color:#2928ff">0</span><span style="color:#000000">;</span>i <span style="color:#000000">&lt;</span> n<span style="color:#000000">;</span>i<span style="color:#000000">++) {</span>
    j <span style="color:#000000">=</span> Math<span style="color:#000000">.</span><span style="color:#010181">round</span><span style="color:#000000">(</span>Math<span style="color:#000000">.</span><span style="color:#010181">random</span><span style="color:#000000">()*(</span>arr<span style="color:#000000">.</span>length<span style="color:#000000">-</span><span style="color:#2928ff">1</span><span style="color:#000000">));</span>
    res<span style="color:#000000">.</span><span style="color:#010181">push</span><span style="color:#000000">(</span>arr<span style="color:#000000">[</span>j<span style="color:#000000">]);</span>
    arr<span style="color:#000000">.</span><span style="color:#010181">splice</span><span style="color:#000000">(</span>j<span style="color:#000000">,</span><span style="color:#2928ff">1</span><span style="color:#000000">);</span>
  <span style="color:#000000">}</span>
  <span style="color:#000000; font-weight:bold">return</span> res<span style="color:#000000">;</span>
<span style="color:#000000">};</span>
txt <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>node<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>node<span style="color:#000000">.</span>childNodes<span style="color:#000000">.</span>length <span style="color:#000000">===</span> <span style="color:#2928ff">0</span><span style="color:#000000">) {</span>
    <span style="color:#000000; font-weight:bold">return</span> <span style="color:#ff0000">''</span><span style="color:#000000">;</span>
  <span style="color:#000000">}</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> node<span style="color:#000000">.</span>textContent <span style="color:#000000">!==</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
    <span style="color:#000000; font-weight:bold">return</span> node<span style="color:#000000">.</span>textContent<span style="color:#000000">;</span>
  <span style="color:#000000">}</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> node<span style="color:#000000">.</span>innerText <span style="color:#000000">!==</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
    <span style="color:#000000; font-weight:bold">return</span> node<span style="color:#000000">.</span>innerText<span style="color:#000000">;</span>
  <span style="color:#000000">}</span>
  <span style="color:#010181">except</span><span style="color:#000000">(</span><span style="color:#ff0000">'cannot get text from node'</span><span style="color:#000000">);</span>
<span style="color:#000000">};</span>
getData <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>el<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">var</span> arr<span style="color:#000000">,</span> e<span style="color:#000000">,</span> i<span style="color:#000000">;</span>

  <span style="color:#000000; font-weight:bold">try</span> <span style="color:#000000">{</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>el<span style="color:#000000">.</span>nodeType <span style="color:#000000">===</span> <span style="color:#2928ff">3</span><span style="color:#000000">) {</span>
    <span style="color:#000000; font-weight:bold">return</span> el<span style="color:#000000">.</span>data<span style="color:#000000">;</span>
  <span style="color:#000000">}</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>el<span style="color:#000000">.</span>classList<span style="color:#000000">.</span><span style="color:#010181">contains</span><span style="color:#000000">(</span><span style="color:#ff0000">'url'</span><span style="color:#000000">)) {</span>
    <span style="color:#000000; font-weight:bold">return</span> el<span style="color:#000000">.</span>href<span style="color:#000000">;</span>
  <span style="color:#000000">}</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>el<span style="color:#000000">.</span>classList<span style="color:#000000">.</span><span style="color:#010181">contains</span><span style="color:#000000">(</span><span style="color:#ff0000">'fsm'</span><span style="color:#000000">) ||</span> el<span style="color:#000000">.</span>classList<span style="color:#000000">.</span><span style="color:#010181">contains</span><span style="color:#000000">(</span><span style="color:#ff0000">'mediaRowWrapper'</span><span style="color:#000000">)) {</span>
    el <span style="color:#000000">=</span> el<span style="color:#000000">.</span>firstChild<span style="color:#000000">;</span>
  <span style="color:#000000">}</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>el<span style="color:#000000">.</span>classList<span style="color:#000000">.</span><span style="color:#010181">contains</span><span style="color:#000000">(</span><span style="color:#ff0000">'uiList'</span><span style="color:#000000">)) {</span>
    <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>el<span style="color:#000000">.</span>firstChild<span style="color:#000000">.</span>lastChild<span style="color:#000000">.</span>nodeType <span style="color:#000000">===</span> <span style="color:#2928ff">1</span> <span style="color:#000000">&amp;&amp;</span> el<span style="color:#000000">.</span>firstChild<span style="color:#000000">.</span>lastChild<span style="color:#000000">.</span>classList<span style="color:#000000">.</span><span style="color:#010181">contains</span><span style="color:#000000">(</span><span style="color:#ff0000">'pls'</span><span style="color:#000000">) &amp;&amp;</span> el<span style="color:#000000">.</span>firstChild<span style="color:#000000">.</span>lastChild<span style="color:#000000">.</span>classList<span style="color:#000000">.</span><span style="color:#010181">contains</span><span style="color:#000000">(</span><span style="color:#ff0000">'inlineLabel'</span><span style="color:#000000">)) {</span>
      arr <span style="color:#000000">= {};</span>
      <span style="color:#000000; font-weight:bold">for</span><span style="color:#000000">(</span>i <span style="color:#000000">=</span> <span style="color:#2928ff">0</span><span style="color:#000000">,</span> c <span style="color:#000000">=</span> el<span style="color:#000000">.</span>childNodes<span style="color:#000000">;</span>c<span style="color:#000000">[</span>i<span style="color:#000000">];</span>i<span style="color:#000000">++) {</span>
        e <span style="color:#000000">=</span> c<span style="color:#000000">[</span>i<span style="color:#000000">].</span>lastChild<span style="color:#000000">.</span>firstChild<span style="color:#000000">;</span>
        <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> arr<span style="color:#000000">[</span>e<span style="color:#000000">.</span>data<span style="color:#000000">] ===</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
          arr<span style="color:#000000">[</span>e<span style="color:#000000">.</span>data<span style="color:#000000">] = [];</span>
        <span style="color:#000000">}</span>
        <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>c<span style="color:#000000">[</span>i<span style="color:#000000">].</span>firstChild<span style="color:#000000">.</span>nodeType <span style="color:#000000">===</span> <span style="color:#2928ff">3</span><span style="color:#000000">) {</span>
          arr<span style="color:#000000">[</span>e<span style="color:#000000">.</span>data<span style="color:#000000">].</span><span style="color:#010181">push</span><span style="color:#000000">(</span>c<span style="color:#000000">[</span>i<span style="color:#000000">].</span>firstChild<span style="color:#000000">.</span>data<span style="color:#000000">);</span>
        <span style="color:#000000">}</span> <span style="color:#000000; font-weight:bold">else</span> <span style="color:#000000">{</span>
          arr<span style="color:#000000">[</span>e<span style="color:#000000">.</span>data<span style="color:#000000">].</span><span style="color:#010181">push</span><span style="color:#000000">(</span><span style="color:#010181">txt</span><span style="color:#000000">(</span>c<span style="color:#000000">[</span>i<span style="color:#000000">].</span>firstChild<span style="color:#000000">));</span>
        <span style="color:#000000">}</span>
      <span style="color:#000000">}</span>
    <span style="color:#000000">}</span> <span style="color:#000000; font-weight:bold">else</span> <span style="color:#000000">{</span>
      arr <span style="color:#000000">= [];</span>
      <span style="color:#000000; font-weight:bold">for</span><span style="color:#000000">(</span>i <span style="color:#000000">=</span> <span style="color:#2928ff">0</span><span style="color:#000000">,</span> c <span style="color:#000000">=</span> el<span style="color:#000000">.</span>childNodes<span style="color:#000000">;</span>c<span style="color:#000000">[</span>i<span style="color:#000000">];</span>i<span style="color:#000000">++) {</span>
        <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>c<span style="color:#000000">[</span>i<span style="color:#000000">].</span>firstChild<span style="color:#000000">.</span>nodeType <span style="color:#000000">===</span> <span style="color:#2928ff">3</span><span style="color:#000000">) {</span>
          arr<span style="color:#000000">.</span><span style="color:#010181">push</span><span style="color:#000000">(</span>c<span style="color:#000000">[</span>i<span style="color:#000000">].</span>firstChild<span style="color:#000000">.</span>data<span style="color:#000000">);</span>
        <span style="color:#000000">}</span> <span style="color:#000000; font-weight:bold">else</span> <span style="color:#000000">{</span>
          arr<span style="color:#000000">.</span><span style="color:#010181">push</span><span style="color:#000000">(</span><span style="color:#010181">txt</span><span style="color:#000000">(</span>c<span style="color:#000000">[</span>i<span style="color:#000000">]));</span>
        <span style="color:#000000">}</span>
      <span style="color:#000000">}</span>
    <span style="color:#000000">}</span>
    <span style="color:#000000; font-weight:bold">return</span> arr<span style="color:#000000">;</span>
  <span style="color:#000000">}</span>
  <span style="color:#000000">}</span> <span style="color:#000000; font-weight:bold">catch</span><span style="color:#000000">(</span>ex<span style="color:#000000">) {</span>
    <span style="color:#010181">except</span><span style="color:#000000">(</span><span style="color:#ff0000">'failed at '</span> <span style="color:#000000">+</span> <span style="color:#010181">txt</span><span style="color:#000000">(</span>el<span style="color:#000000">));</span>
  <span style="color:#000000">}</span>
  <span style="color:#000000; font-weight:bold">return</span> <span style="color:#010181">txt</span><span style="color:#000000">(</span>el<span style="color:#000000">);</span>
<span style="color:#000000">};</span>
ready <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>w<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">return</span> w<span style="color:#000000">.</span>document<span style="color:#000000">.</span><span style="color:#010181">querySelectorAll</span><span style="color:#000000">(</span><span style="color:#ff0000">'td.data'</span><span style="color:#000000">).</span>length <span style="color:#000000">&gt;</span> <span style="color:#2928ff">0</span><span style="color:#000000">;</span>
<span style="color:#000000">};</span>
fillData <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>o<span style="color:#000000">,</span> w<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">var</span> i<span style="color:#000000">,</span> data<span style="color:#000000">,</span> label<span style="color:#000000">;</span>

  data <span style="color:#000000">=</span> w<span style="color:#000000">.</span>document<span style="color:#000000">.</span><span style="color:#010181">querySelectorAll</span><span style="color:#000000">(</span><span style="color:#ff0000">'td.data'</span><span style="color:#000000">);</span>
  label <span style="color:#000000">=</span> w<span style="color:#000000">.</span>document<span style="color:#000000">.</span><span style="color:#010181">querySelectorAll</span><span style="color:#000000">(</span><span style="color:#ff0000">'th.label'</span><span style="color:#000000">);</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>data<span style="color:#000000">.</span>length <span style="color:#000000">!==</span> label<span style="color:#000000">.</span>length<span style="color:#000000">) {</span>
    <span style="color:#010181">except</span><span style="color:#000000">(</span><span style="color:#ff0000">'data length does not equal label length'</span><span style="color:#000000">);</span>
  <span style="color:#000000">}</span>
  <span style="color:#000000; font-weight:bold">for</span><span style="color:#000000">(</span>i <span style="color:#000000">=</span> <span style="color:#2928ff">0</span><span style="color:#000000">;</span> data<span style="color:#000000">[</span>i<span style="color:#000000">];</span> i<span style="color:#000000">++) {</span>
    <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>label<span style="color:#000000">[</span>i<span style="color:#000000">].</span>firstChild <span style="color:#000000">!==</span> <span style="color:#000000; font-weight:bold">null</span><span style="color:#000000">) {</span>
      o<span style="color:#000000">[</span>label<span style="color:#000000">[</span>i<span style="color:#000000">].</span>firstChild<span style="color:#000000">.</span>data<span style="color:#000000">] =</span> <span style="color:#010181">getData</span><span style="color:#000000">(</span>data<span style="color:#000000">[</span>i<span style="color:#000000">].</span>firstChild<span style="color:#000000">);</span>
    <span style="color:#000000">}</span>
  <span style="color:#000000">}</span>
<span style="color:#000000">};</span>
iframe <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>url<span style="color:#000000">,</span> callback<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">var</span> el<span style="color:#000000">;</span>

  el <span style="color:#000000">=</span> window<span style="color:#000000">.</span>document<span style="color:#000000">.</span><span style="color:#010181">createElement</span><span style="color:#000000">(</span><span style="color:#ff0000">'iframe'</span><span style="color:#000000">);</span>
  el<span style="color:#000000">.</span>src <span style="color:#000000">=</span> url<span style="color:#000000">;</span>
  el<span style="color:#000000">.</span>onload <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">() {</span>
    <span style="color:#010181">callback</span><span style="color:#000000">(</span>el<span style="color:#000000">.</span>contentWindow<span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">() {</span>
      window<span style="color:#000000">.</span>document<span style="color:#000000">.</span>body<span style="color:#000000">.</span><span style="color:#010181">removeChild</span><span style="color:#000000">(</span>el<span style="color:#000000">);</span>
    <span style="color:#000000">});</span>
  <span style="color:#000000">};</span>
  el<span style="color:#000000">.</span>height <span style="color:#000000">=</span> <span style="color:#2928ff">1</span><span style="color:#000000">;</span>
  el<span style="color:#000000">.</span>width <span style="color:#000000">=</span> <span style="color:#2928ff">1</span><span style="color:#000000">;</span>
  el<span style="color:#000000">.</span>style<span style="color:#000000">.</span>opacity <span style="color:#000000">=</span> <span style="color:#2928ff">0</span><span style="color:#000000">;</span>
  window<span style="color:#000000">.</span>document<span style="color:#000000">.</span>body<span style="color:#000000">.</span><span style="color:#010181">appendChild</span><span style="color:#000000">(</span>el<span style="color:#000000">);</span>
<span style="color:#000000">};</span>
IframeSeries <span style="color:#000000">= {</span>
  el <span style="color:#000000">:</span> window<span style="color:#000000">.</span>document<span style="color:#000000">.</span><span style="color:#010181">createElement</span><span style="color:#000000">(</span><span style="color:#ff0000">'iframe'</span><span style="color:#000000">),</span>
  load <span style="color:#000000">:</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>url<span style="color:#000000">,</span> callback<span style="color:#000000">) {</span>
    <span style="color:#000000; font-weight:bold">var</span> that <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">this</span><span style="color:#000000">;</span>
    <span style="color:#000000; font-weight:bold">this</span><span style="color:#000000">.</span>el<span style="color:#000000">.</span>onload <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">() {</span>
      <span style="color:#010181">callback</span><span style="color:#000000">(</span>that<span style="color:#000000">.</span>el<span style="color:#000000">.</span>contentWindow<span style="color:#000000">);</span>
    <span style="color:#000000">};</span>
    <span style="color:#000000; font-weight:bold">this</span><span style="color:#000000">.</span>el<span style="color:#000000">.</span>src <span style="color:#000000">=</span> url<span style="color:#000000">;</span>
  <span style="color:#000000">}</span>
<span style="color:#000000">};</span>
window<span style="color:#000000">.</span>document<span style="color:#000000">.</span>body<span style="color:#000000">.</span><span style="color:#010181">appendChild</span><span style="color:#000000">(</span>IframeSeries<span style="color:#000000">.</span>el<span style="color:#000000">);</span>
fillBorn <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>w<span style="color:#000000">,</span> contact<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">var</span> i<span style="color:#000000">,</span> lines<span style="color:#000000">,</span> prefix<span style="color:#000000">,</span> date<span style="color:#000000">,</span> text<span style="color:#000000">;</span>

  lines <span style="color:#000000">=</span> w<span style="color:#000000">.</span>document<span style="color:#000000">.</span><span style="color:#010181">querySelectorAll</span><span style="color:#000000">(</span><span style="color:#ff0000">'.fbProfileBylineFragment'</span><span style="color:#000000">);</span>
  prefix <span style="color:#000000">=</span> <span style="color:#ff0000">'Born on '</span><span style="color:#000000">;</span>
  date <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">null</span><span style="color:#000000">;</span>
  <span style="color:#000000; font-weight:bold">for</span><span style="color:#000000">(</span>i <span style="color:#000000">=</span> <span style="color:#2928ff">0</span><span style="color:#000000">;</span> lines<span style="color:#000000">[</span>i<span style="color:#000000">];</span> i<span style="color:#000000">++) {</span>
    text <span style="color:#000000">=</span> lines<span style="color:#000000">[</span>i<span style="color:#000000">].</span>childNodes<span style="color:#000000">[</span><span style="color:#2928ff">1</span><span style="color:#000000">].</span>data<span style="color:#000000">;</span>
    <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>text<span style="color:#000000">.</span><span style="color:#010181">indexOf</span><span style="color:#000000">(</span>prefix<span style="color:#000000">) ===</span> <span style="color:#2928ff">0</span><span style="color:#000000">) {</span>
      text <span style="color:#000000">=</span> text<span style="color:#000000">.</span><span style="color:#010181">substr</span><span style="color:#000000">(</span>prefix<span style="color:#000000">.</span>length<span style="color:#000000">);</span>
      <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(!</span>Date<span style="color:#000000">.</span><span style="color:#010181">parse</span><span style="color:#000000">(</span>text<span style="color:#000000">)) {</span>
        text <span style="color:#000000">+=</span> <span style="color:#ff0000">', 2010'</span><span style="color:#000000">;</span>
      <span style="color:#000000">}</span>
      contact<span style="color:#000000">.</span>born <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">new</span> <span style="color:#010181">Date</span><span style="color:#000000">(</span>text<span style="color:#000000">);</span>
      <span style="color:#000000; font-weight:bold">return</span><span style="color:#000000">;</span>
    <span style="color:#000000">}</span>
  <span style="color:#000000">}</span>
<span style="color:#000000">};</span>
fillCityCountry <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>line<span style="color:#000000">,</span> contact<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">var</span> a<span style="color:#000000">;</span>

  a <span style="color:#000000">=</span> line<span style="color:#000000">.</span><span style="color:#010181">split</span><span style="color:#000000">(</span><span style="color:#ff0000">', '</span><span style="color:#000000">);</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>a<span style="color:#000000">.</span>length <span style="color:#000000">&gt;</span> <span style="color:#2928ff">2</span><span style="color:#000000">) {</span>
    <span style="color:#000000; font-weight:bold">throw</span> <span style="color:#ff0000">'unexpectedly many comma-separated values in address'</span><span style="color:#000000">;</span>
  <span style="color:#000000">}</span> <span style="color:#000000; font-weight:bold">else if</span><span style="color:#000000">(</span>a<span style="color:#000000">.</span>length <span style="color:#000000">===</span> <span style="color:#2928ff">1</span><span style="color:#000000">) {</span>
    contact<span style="color:#000000">[</span><span style="color:#ff0000">'Home country'</span><span style="color:#000000">] =</span> a<span style="color:#000000">[</span><span style="color:#2928ff">0</span><span style="color:#000000">];</span>
  <span style="color:#000000">}</span> <span style="color:#000000; font-weight:bold">else</span> <span style="color:#000000">{</span>
    contact<span style="color:#000000">[</span><span style="color:#ff0000">'Home city'</span><span style="color:#000000">] =</span> a<span style="color:#000000">[</span><span style="color:#2928ff">0</span><span style="color:#000000">];</span>
    contact<span style="color:#000000">[</span><span style="color:#ff0000">'Home country'</span><span style="color:#000000">] =</span> a<span style="color:#000000">[</span><span style="color:#2928ff">1</span><span style="color:#000000">];</span>
  <span style="color:#000000">}</span>
<span style="color:#000000">};</span>
multi <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>prefix<span style="color:#000000">,</span> target<span style="color:#000000">,</span> source<span style="color:#000000">,</span> prop<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> source<span style="color:#000000">[</span>prop<span style="color:#000000">] ===</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
    <span style="color:#010181">log</span><span style="color:#000000">(</span><span style="color:#ff0000">'no'</span><span style="color:#000000">,</span> prop<span style="color:#000000">);</span>
    <span style="color:#000000; font-weight:bold">return</span><span style="color:#000000">;</span>
  <span style="color:#000000">}</span>
  source<span style="color:#000000">[</span>prop<span style="color:#000000">].</span><span style="color:#010181">forEach</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>e<span style="color:#000000">,</span> i<span style="color:#000000">) {</span>
    target<span style="color:#000000">[</span>prefix <span style="color:#000000">+ (</span>i <span style="color:#000000">&gt;</span> <span style="color:#2928ff">0</span> ? <span style="color:#000000">(</span><span style="color:#ff0000">' '</span> <span style="color:#000000">+ (</span>i <span style="color:#000000">+</span> <span style="color:#2928ff">1</span><span style="color:#000000">)) :</span> <span style="color:#ff0000">''</span><span style="color:#000000">)] =</span> e<span style="color:#000000">;</span>
  <span style="color:#000000">});</span>
  <span style="color:#000000; font-weight:bold">delete</span> source<span style="color:#000000">[</span>prop<span style="color:#000000">];</span>
<span style="color:#000000">};</span>
screenNames <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>contact<span style="color:#000000">,</span> key<span style="color:#000000">,</span> types<span style="color:#000000">) {</span>
  Object<span style="color:#000000">.</span><span style="color:#010181">keys</span><span style="color:#000000">(</span>types<span style="color:#000000">).</span><span style="color:#010181">forEach</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>i<span style="color:#000000">) {</span>
    <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> contact<span style="color:#000000">[</span>key<span style="color:#000000">][</span><span style="color:#ff0000">'('</span> <span style="color:#000000">+</span> i <span style="color:#000000">+</span> <span style="color:#ff0000">')'</span><span style="color:#000000">] !==</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
      <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>i <span style="color:#000000">===</span> <span style="color:#ff0000">'Google Talk'</span><span style="color:#000000">) {</span>
        contact<span style="color:#000000">.</span>Email<span style="color:#000000">.</span><span style="color:#010181">push</span><span style="color:#000000">(</span>contact<span style="color:#000000">[</span>key<span style="color:#000000">][</span><span style="color:#ff0000">'('</span> <span style="color:#000000">+</span> i <span style="color:#000000">+</span> <span style="color:#ff0000">')'</span><span style="color:#000000">][</span><span style="color:#2928ff">0</span><span style="color:#000000">]);</span>
      <span style="color:#000000">}</span>
      <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>i <span style="color:#000000">===</span> <span style="color:#ff0000">'Twitter'</span><span style="color:#000000">) {</span>
        contact<span style="color:#000000">.</span>Website<span style="color:#000000">.</span><span style="color:#010181">push</span><span style="color:#000000">(</span><span style="color:#ff0000">'http://twitter.com/'</span> <span style="color:#000000">+</span> contact<span style="color:#000000">[</span>key<span style="color:#000000">][</span><span style="color:#ff0000">'(Twitter)'</span><span style="color:#000000">][</span><span style="color:#2928ff">0</span><span style="color:#000000">]);</span>
      <span style="color:#000000">}</span> <span style="color:#000000; font-weight:bold">else</span> <span style="color:#000000">{</span>
        <span style="color:#000000; font-weight:bold">var</span> o <span style="color:#000000">=</span> <span style="color:#2928ff">0</span><span style="color:#000000">;</span>
        <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> contact<span style="color:#000000">[</span><span style="color:#ff0000">'IM '</span> <span style="color:#000000">+</span> types<span style="color:#000000">[</span>i<span style="color:#000000">]] ===</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
          o<span style="color:#000000">++;</span>
          contact<span style="color:#000000">[</span><span style="color:#ff0000">'IM '</span> <span style="color:#000000">+</span> types<span style="color:#000000">[</span>i<span style="color:#000000">]] =</span> contact<span style="color:#000000">[</span>key<span style="color:#000000">][</span><span style="color:#ff0000">'('</span> <span style="color:#000000">+</span> i <span style="color:#000000">+</span> <span style="color:#ff0000">')'</span><span style="color:#000000">][</span><span style="color:#2928ff">0</span><span style="color:#000000">];</span>
        <span style="color:#000000">}</span>
        contact<span style="color:#000000">[</span>key<span style="color:#000000">][</span><span style="color:#ff0000">'('</span> <span style="color:#000000">+</span> i <span style="color:#000000">+</span> <span style="color:#ff0000">')'</span><span style="color:#000000">].</span><span style="color:#010181">slice</span><span style="color:#000000">(</span>o<span style="color:#000000">).</span><span style="color:#010181">forEach</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>value<span style="color:#000000">) {</span>
          contact<span style="color:#000000">[</span><span style="color:#ff0000">'Additional info'</span><span style="color:#000000">] +=</span> <span style="color:#ff0000">'IM '</span> <span style="color:#000000">+</span> types<span style="color:#000000">[</span>i<span style="color:#000000">] +</span> <span style="color:#ff0000">': '</span> <span style="color:#000000">+</span> value <span style="color:#000000">+</span> <span style="color:#ff0000">'; '</span><span style="color:#000000">;</span>
        <span style="color:#000000">});</span>
      <span style="color:#000000">}</span>
      <span style="color:#000000; font-weight:bold">delete</span> contact<span style="color:#000000">[</span>key<span style="color:#000000">][</span><span style="color:#ff0000">'('</span> <span style="color:#000000">+</span> i <span style="color:#000000">+</span> <span style="color:#ff0000">')'</span><span style="color:#000000">];</span>
    <span style="color:#000000">}</span>
  <span style="color:#000000">});</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>Object<span style="color:#000000">.</span><span style="color:#010181">keys</span><span style="color:#000000">(</span>contact<span style="color:#000000">[</span>key<span style="color:#000000">]).</span>length <span style="color:#000000">&gt;</span> <span style="color:#2928ff">0</span><span style="color:#000000">) {</span>
    <span style="color:#010181">except</span><span style="color:#000000">(</span><span style="color:#ff0000">'too many '</span><span style="color:#000000">+</span>key<span style="color:#000000">+</span><span style="color:#ff0000">' defined: '</span> <span style="color:#000000">+</span> JSON<span style="color:#000000">.</span><span style="color:#010181">stringify</span><span style="color:#000000">(</span>contact<span style="color:#000000">[</span>key<span style="color:#000000">]));</span>
  <span style="color:#000000">}</span>
  <span style="color:#000000; font-weight:bold">delete</span> contact<span style="color:#000000">[</span>key<span style="color:#000000">];</span>
<span style="color:#000000">};</span>
screenNamesAndEmailsAndWebsites <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>contact<span style="color:#000000">,</span> types<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> contact<span style="color:#000000">.</span>Email <span style="color:#000000">===</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
    contact<span style="color:#000000">.</span>Email <span style="color:#000000">= [];</span>
  <span style="color:#000000">}</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> contact<span style="color:#000000">.</span>Website <span style="color:#000000">===</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
    contact<span style="color:#000000">.</span>Website <span style="color:#000000">= [];</span>
  <span style="color:#000000">}</span>
  contact<span style="color:#000000">[</span><span style="color:#ff0000">'Additional info'</span><span style="color:#000000">] +=</span> <span style="color:#ff0000">'Facebook profile: '</span> <span style="color:#000000">+</span> contact<span style="color:#000000">.</span>url<span style="color:#000000">[</span><span style="color:#2928ff">0</span><span style="color:#000000">] +</span> <span style="color:#ff0000">'; '</span><span style="color:#000000">;</span>
  <span style="color:#000000; font-weight:bold">delete</span> contact<span style="color:#000000">.</span>url<span style="color:#000000">;</span>
  contact<span style="color:#000000">.</span>Website <span style="color:#000000">=</span> contact<span style="color:#000000">.</span>Website<span style="color:#000000">.</span><span style="color:#010181">filter</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>url<span style="color:#000000">) {</span>
    <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>url<span style="color:#000000">.</span><span style="color:#010181">substr</span><span style="color:#000000">(</span><span style="color:#2928ff">0</span><span style="color:#000000">,</span> <span style="color:#2928ff">4</span><span style="color:#000000">) !==</span> <span style="color:#ff0000">'http'</span><span style="color:#000000">) {</span>
      <span style="color:#010181">log</span><span style="color:#000000">(</span><span style="color:#ff0000">'unknown website'</span><span style="color:#000000">,</span> url<span style="color:#000000">);</span>
      <span style="color:#000000; font-weight:bold">return false</span><span style="color:#000000">;</span>
    <span style="color:#000000">}</span>
    <span style="color:#000000; font-weight:bold">return true</span><span style="color:#000000">;</span>
  <span style="color:#000000">});</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> contact<span style="color:#000000">[</span><span style="color:#ff0000">'Screen Name'</span><span style="color:#000000">] !==</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
    <span style="color:#010181">screenNames</span><span style="color:#000000">(</span>contact<span style="color:#000000">,</span> <span style="color:#ff0000">'Screen Name'</span><span style="color:#000000">,</span> types<span style="color:#000000">);</span>
  <span style="color:#000000">}</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> contact<span style="color:#000000">[</span><span style="color:#ff0000">'Screen Names'</span><span style="color:#000000">] !==</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
    <span style="color:#010181">screenNames</span><span style="color:#000000">(</span>contact<span style="color:#000000">,</span> <span style="color:#ff0000">'Screen Names'</span><span style="color:#000000">,</span> types<span style="color:#000000">);</span>
  <span style="color:#000000">}</span>
  <span style="color:#010181">multi</span><span style="color:#000000">(</span><span style="color:#ff0000">'E-Mail'</span><span style="color:#000000">,</span> contact<span style="color:#000000">,</span> contact<span style="color:#000000">,</span> <span style="color:#ff0000">'Email'</span><span style="color:#000000">);</span>
  <span style="color:#010181">multi</span><span style="color:#000000">(</span><span style="color:#ff0000">'WWW'</span><span style="color:#000000">,</span> contact<span style="color:#000000">,</span> contact<span style="color:#000000">,</span> <span style="color:#ff0000">'Website'</span><span style="color:#000000">);</span>
<span style="color:#000000">};</span>
fill <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>w<span style="color:#000000">,</span> contact<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">var</span> i<span style="color:#000000">,</span> d<span style="color:#000000">,</span> month<span style="color:#000000">,</span> day<span style="color:#000000">,</span> j<span style="color:#000000">,</span> found<span style="color:#000000">,</span> names<span style="color:#000000">;</span>

  <span style="color:#000000; font-weight:bold">try</span> <span style="color:#000000">{</span>
    found <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">false</span><span style="color:#000000">;</span>
    <span style="color:#000000; font-weight:bold">for</span><span style="color:#000000">(</span>i <span style="color:#000000">=</span> <span style="color:#2928ff">0</span><span style="color:#000000">,</span> c <span style="color:#000000">=</span> w<span style="color:#000000">.</span>document<span style="color:#000000">.</span><span style="color:#010181">querySelectorAll</span><span style="color:#000000">(</span><span style="color:#ff0000">'script'</span><span style="color:#000000">);</span>c<span style="color:#000000">[</span>i<span style="color:#000000">];</span>i<span style="color:#000000">++) {</span>
      j <span style="color:#000000">=</span> <span style="color:#010181">txt</span><span style="color:#000000">(</span>c<span style="color:#000000">[</span>i<span style="color:#000000">]).</span><span style="color:#010181">indexOf</span><span style="color:#000000">(</span><span style="color:#ff0000">'navigation.php?id='</span><span style="color:#000000">);</span>
      <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>j <span style="color:#000000">&gt;=</span> <span style="color:#2928ff">0</span><span style="color:#000000">) {</span>
        found <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">true</span><span style="color:#000000">;</span>
        contact<span style="color:#000000">[</span><span style="color:#ff0000">'Additional info'</span><span style="color:#000000">] =</span> <span style="color:#ff0000">'Facebook ID: '</span> <span style="color:#000000">+</span> <span style="color:#010181">txt</span><span style="color:#000000">(</span>c<span style="color:#000000">[</span>i<span style="color:#000000">]).</span><span style="color:#010181">substring</span><span style="color:#000000">(</span>j <span style="color:#000000">+</span> <span style="color:#ff0000">'navigation.php?id='</span><span style="color:#000000">.</span>length<span style="color:#000000">,</span> <span style="color:#010181">txt</span><span style="color:#000000">(</span>c<span style="color:#000000">[</span>i<span style="color:#000000">]).</span><span style="color:#010181">indexOf</span><span style="color:#000000">(</span><span style="color:#ff0000">'</span><span style="color:#ff00ff">\\</span><span style="color:#ff0000">'</span><span style="color:#000000">,</span> j<span style="color:#000000">)) +</span> <span style="color:#ff0000">'; '</span><span style="color:#000000">;</span>
      <span style="color:#000000">}</span>
    <span style="color:#000000">}</span>
    <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(!</span>found<span style="color:#000000">) {</span>
      <span style="color:#010181">except</span><span style="color:#000000">(</span><span style="color:#ff0000">'could not find Facebook ID'</span><span style="color:#000000">);</span>
    <span style="color:#000000">}</span>

    <span style="color:#010181">fillData</span><span style="color:#000000">(</span>contact<span style="color:#000000">,</span> w<span style="color:#000000">);</span>

    names <span style="color:#000000">=</span> contact<span style="color:#000000">.</span>fullName<span style="color:#000000">.</span><span style="color:#010181">split</span><span style="color:#000000">(/</span>\s<span style="color:#000000">/</span>g<span style="color:#000000">);</span>
    contact<span style="color:#000000">[</span><span style="color:#ff0000">'First name'</span><span style="color:#000000">] =</span> names<span style="color:#000000">[</span><span style="color:#2928ff">0</span><span style="color:#000000">];</span>
    contact<span style="color:#000000">[</span><span style="color:#ff0000">'Last name'</span><span style="color:#000000">] =</span> names<span style="color:#000000">[</span>names<span style="color:#000000">.</span>length <span style="color:#000000">-</span> <span style="color:#2928ff">1</span><span style="color:#000000">];</span>
    <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>names<span style="color:#000000">.</span>length <span style="color:#000000">&gt;</span> <span style="color:#2928ff">2</span><span style="color:#000000">) {</span>
      contact<span style="color:#000000">[</span><span style="color:#ff0000">'Second name'</span><span style="color:#000000">] =</span> names<span style="color:#000000">[</span><span style="color:#2928ff">1</span><span style="color:#000000">];</span>
    <span style="color:#000000">}</span>
    <span style="color:#000000; font-weight:bold">delete</span> contact<span style="color:#000000">.</span>fullName<span style="color:#000000">;</span>

    <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> contact<span style="color:#000000">.</span>Address <span style="color:#000000">!==</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
      <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>contact<span style="color:#000000">.</span>Address<span style="color:#000000">.</span>length <span style="color:#000000">&gt;</span> <span style="color:#2928ff">2</span><span style="color:#000000">) {</span>
        <span style="color:#010181">except</span><span style="color:#000000">(</span><span style="color:#ff0000">'unexpectedly long address: '</span> <span style="color:#000000">+</span> contact<span style="color:#000000">.</span>Address<span style="color:#000000">);</span>
      <span style="color:#000000">}</span> <span style="color:#000000; font-weight:bold">else if</span><span style="color:#000000">(</span>contact<span style="color:#000000">.</span>Address<span style="color:#000000">.</span>length <span style="color:#000000">===</span> <span style="color:#2928ff">1</span><span style="color:#000000">) {</span>
        <span style="color:#010181">fillCityCountry</span><span style="color:#000000">(</span>contact<span style="color:#000000">.</span>Address<span style="color:#000000">[</span><span style="color:#2928ff">0</span><span style="color:#000000">],</span> contact<span style="color:#000000">);</span>
        <span style="color:#000000; font-weight:bold">delete</span> contact<span style="color:#000000">.</span>Address<span style="color:#000000">;</span>
      <span style="color:#000000">}</span> <span style="color:#000000; font-weight:bold">else</span> <span style="color:#000000">{</span>
        contact<span style="color:#000000">[</span><span style="color:#ff0000">'Home address'</span><span style="color:#000000">] =</span> contact<span style="color:#000000">.</span>Address<span style="color:#000000">[</span><span style="color:#2928ff">0</span><span style="color:#000000">];</span>
        <span style="color:#010181">fillCityCountry</span><span style="color:#000000">(</span>contact<span style="color:#000000">.</span>Address<span style="color:#000000">[</span><span style="color:#2928ff">1</span><span style="color:#000000">],</span> contact<span style="color:#000000">);</span>
        <span style="color:#000000; font-weight:bold">delete</span> contact<span style="color:#000000">.</span>Address<span style="color:#000000">;</span>
      <span style="color:#000000">}</span>
    <span style="color:#000000">}</span>

    <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> contact<span style="color:#000000">.</span>Phone <span style="color:#000000">!==</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
      i <span style="color:#000000">=</span> <span style="color:#2928ff">0</span><span style="color:#000000">;</span>
      <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> contact<span style="color:#000000">.</span>Phone<span style="color:#000000">.</span>Mobile <span style="color:#000000">!==</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
        i<span style="color:#000000">++;</span>
        <span style="color:#010181">multi</span><span style="color:#000000">(</span><span style="color:#ff0000">'Cell phone'</span><span style="color:#000000">,</span> contact<span style="color:#000000">,</span> contact<span style="color:#000000">.</span>Phone<span style="color:#000000">,</span> <span style="color:#ff0000">'Mobile'</span><span style="color:#000000">);</span>
      <span style="color:#000000">}</span>
      <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> contact<span style="color:#000000">.</span>Phone<span style="color:#000000">.</span>Home <span style="color:#000000">!==</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
        i<span style="color:#000000">++;</span>
        <span style="color:#010181">multi</span><span style="color:#000000">(</span><span style="color:#ff0000">'Home phone'</span><span style="color:#000000">,</span> contact<span style="color:#000000">,</span> contact<span style="color:#000000">.</span>Phone<span style="color:#000000">,</span> <span style="color:#ff0000">'Home'</span><span style="color:#000000">);</span>
      <span style="color:#000000">}</span>
      <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>Object<span style="color:#000000">.</span><span style="color:#010181">keys</span><span style="color:#000000">(</span>contact<span style="color:#000000">.</span>Phone<span style="color:#000000">).</span>length <span style="color:#000000">!==</span> <span style="color:#2928ff">0</span><span style="color:#000000">) {</span>
        <span style="color:#010181">except</span><span style="color:#000000">(</span><span style="color:#ff0000">'too many phones defined: '</span> <span style="color:#000000">+</span> JSON<span style="color:#000000">.</span><span style="color:#010181">stringify</span><span style="color:#000000">(</span>contact<span style="color:#000000">.</span>Phone<span style="color:#000000">) +</span> <span style="color:#ff0000">', '</span> <span style="color:#000000">+</span> Object<span style="color:#000000">.</span><span style="color:#010181">keys</span><span style="color:#000000">(</span>contact<span style="color:#000000">.</span>Phone<span style="color:#000000">));</span>
      <span style="color:#000000">}</span>
      <span style="color:#000000; font-weight:bold">delete</span> contact<span style="color:#000000">.</span>Phone<span style="color:#000000">;</span>
    <span style="color:#000000">}</span>

    <span style="color:#010181">screenNamesAndEmailsAndWebsites</span><span style="color:#000000">(</span>contact<span style="color:#000000">, {</span><span style="color:#ff0000">'Skype'</span><span style="color:#000000">:</span><span style="color:#ff0000">'Skype'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Twitter'</span><span style="color:#000000">:</span><span style="color:#ff0000">'Twitter'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'AIM'</span><span style="color:#000000">:</span><span style="color:#ff0000">'AOL'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Google Talk'</span><span style="color:#000000">:</span><span style="color:#ff0000">'Jabber'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Windows Live Messenger'</span><span style="color:#000000">:</span><span style="color:#ff0000">'MSN'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Yahoo! Messenger'</span><span style="color:#000000">:</span><span style="color:#ff0000">'Yahoo'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'Gadu-Gadu'</span><span style="color:#000000">:</span><span style="color:#ff0000">'Gadu-Gadu'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'ICQ'</span><span style="color:#000000">:</span><span style="color:#ff0000">'ICQ'</span><span style="color:#000000">});</span>

    <span style="color:#010181">fillBorn</span><span style="color:#000000">(</span>w<span style="color:#000000">,</span> contact<span style="color:#000000">);</span>
    <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> contact<span style="color:#000000">.</span>born <span style="color:#000000">!==</span> <span style="color:#ff0000">'undefined'</span><span style="color:#000000">) {</span>
      d <span style="color:#000000">=</span> contact<span style="color:#000000">.</span>born<span style="color:#000000">;</span>
      month <span style="color:#000000">=</span> d<span style="color:#000000">.</span><span style="color:#010181">getUTCMonth</span><span style="color:#000000">() +</span> <span style="color:#2928ff">1</span><span style="color:#000000">;</span>
      day <span style="color:#000000">=</span> d<span style="color:#000000">.</span><span style="color:#010181">getUTCDate</span><span style="color:#000000">() +</span> <span style="color:#2928ff">1</span><span style="color:#000000">;</span>
      contact<span style="color:#000000">[</span><span style="color:#ff0000">'Birthday date'</span><span style="color:#000000">] = (</span>month <span style="color:#000000">&lt;</span> <span style="color:#2928ff">10</span> ? <span style="color:#000000">(</span><span style="color:#ff0000">'0'</span> <span style="color:#000000">+</span> month<span style="color:#000000">) :</span> <span style="color:#010181">String</span><span style="color:#000000">(</span>month<span style="color:#000000">)) +</span> <span style="color:#ff0000">'/'</span> <span style="color:#000000">+ (</span>day <span style="color:#000000">&lt;</span> <span style="color:#2928ff">10</span> ? <span style="color:#000000">(</span><span style="color:#ff0000">'0'</span> <span style="color:#000000">+</span> day<span style="color:#000000">) :</span> <span style="color:#010181">String</span><span style="color:#000000">(</span>day<span style="color:#000000">)) +</span> <span style="color:#ff0000">'/'</span> <span style="color:#000000">+</span> d<span style="color:#000000">.</span><span style="color:#010181">getUTCFullYear</span><span style="color:#000000">();</span>
      <span style="color:#000000; font-weight:bold">delete</span> contact<span style="color:#000000">.</span>born<span style="color:#000000">;</span>
    <span style="color:#000000">}</span>
    <span style="color:#000000; font-weight:bold">for</span><span style="color:#000000">(</span>i <span style="color:#000000; font-weight:bold">in</span> contact<span style="color:#000000">) {</span>
      <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>Object<span style="color:#000000">.</span><span style="color:#000000; font-weight:bold">prototype</span><span style="color:#000000">.</span>hasOwnProperty<span style="color:#000000">.</span><span style="color:#010181">call</span><span style="color:#000000">(</span>contact<span style="color:#000000">,</span> i<span style="color:#000000">) &amp;&amp;</span> fieldsToExport<span style="color:#000000">.</span><span style="color:#010181">indexOf</span><span style="color:#000000">(</span>i<span style="color:#000000">) &lt;</span> <span style="color:#2928ff">0</span><span style="color:#000000">) {</span>
        contact<span style="color:#000000">[</span><span style="color:#ff0000">'Additional info'</span><span style="color:#000000">] +=</span> i <span style="color:#000000">+</span> <span style="color:#ff0000">': '</span> <span style="color:#000000">+</span> contact<span style="color:#000000">[</span>i<span style="color:#000000">] +</span> <span style="color:#ff0000">'; '</span><span style="color:#000000">;</span>
        <span style="color:#000000; font-weight:bold">delete</span> contact<span style="color:#000000">[</span>i<span style="color:#000000">];</span>
      <span style="color:#000000">}</span>
    <span style="color:#000000">}</span>
  <span style="color:#000000">}</span> <span style="color:#000000; font-weight:bold">catch</span><span style="color:#000000">(</span>e<span style="color:#000000">) {</span>
    <span style="color:#010181">warn</span><span style="color:#000000">(</span><span style="color:#ff0000">'Contact was not fully read: '</span> <span style="color:#000000">+</span> JSON<span style="color:#000000">.</span><span style="color:#010181">stringify</span><span style="color:#000000">(</span>contact<span style="color:#000000">));</span>
  <span style="color:#000000">}</span>
<span style="color:#000000">};</span>
contactsToCSV <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>contacts<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">var</span> w<span style="color:#000000">,</span> ps<span style="color:#000000">,</span> csv<span style="color:#000000">;</span>

  ps <span style="color:#000000">=</span> fieldsToExport<span style="color:#000000">;</span>
  csv <span style="color:#000000">=</span> ps<span style="color:#000000">.</span><span style="color:#010181">join</span><span style="color:#000000">(</span><span style="color:#ff0000">','</span><span style="color:#000000">) +</span> <span style="color:#ff0000">'</span><span style="color:#ff00ff">\n</span><span style="color:#ff0000">'</span><span style="color:#000000">;</span>
  <span style="color:#010181">log</span><span style="color:#000000">(</span><span style="color:#ff0000">'header'</span><span style="color:#000000">,</span> csv<span style="color:#000000">);</span>
  contacts<span style="color:#000000">.</span><span style="color:#010181">forEach</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>contact<span style="color:#000000">) {</span>
    <span style="color:#000000; font-weight:bold">var</span> arr<span style="color:#000000">;</span>

    arr <span style="color:#000000">= [];</span>
    ps<span style="color:#000000">.</span><span style="color:#010181">forEach</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>p<span style="color:#000000">) {</span>
      <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">typeof</span> contact<span style="color:#000000">[</span>p<span style="color:#000000">] ===</span> <span style="color:#ff0000">'undefined'</span> <span style="color:#000000">||</span> contact<span style="color:#000000">[</span>p<span style="color:#000000">] ===</span> <span style="color:#ff0000">''</span><span style="color:#000000">) {</span>
        arr<span style="color:#000000">.</span><span style="color:#010181">push</span><span style="color:#000000">(</span><span style="color:#ff0000">''</span><span style="color:#000000">);</span>
      <span style="color:#000000">}</span> <span style="color:#000000; font-weight:bold">else</span> <span style="color:#000000">{</span>
        arr<span style="color:#000000">.</span><span style="color:#010181">push</span><span style="color:#000000">(</span><span style="color:#ff0000">'&quot;'</span> <span style="color:#000000">+</span> contact<span style="color:#000000">[</span>p<span style="color:#000000">].</span><span style="color:#010181">replace</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">new</span> <span style="color:#010181">RegExp</span><span style="color:#000000">(</span><span style="color:#ff0000">'&quot;'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'g'</span><span style="color:#000000">),</span><span style="color:#ff0000">'&quot;&quot;'</span><span style="color:#000000">) +</span> <span style="color:#ff0000">'&quot;'</span><span style="color:#000000">);</span>
      <span style="color:#000000">}</span>
    <span style="color:#000000">});</span>
    csv <span style="color:#000000">+=</span> arr<span style="color:#000000">.</span><span style="color:#010181">join</span><span style="color:#000000">(</span><span style="color:#ff0000">','</span><span style="color:#000000">) +</span> <span style="color:#ff0000">'</span><span style="color:#ff00ff">\n</span><span style="color:#ff0000">'</span><span style="color:#000000">;</span>
  <span style="color:#000000">});</span>
  w <span style="color:#000000">=</span> window<span style="color:#000000">.</span><span style="color:#010181">open</span><span style="color:#000000">();</span>
  w<span style="color:#000000">.</span>document<span style="color:#000000">.</span><span style="color:#010181">write</span><span style="color:#000000">(</span><span style="color:#ff0000">'&lt;textarea&gt;'</span> <span style="color:#000000">+</span> csv <span style="color:#000000">+</span> <span style="color:#ff0000">'&lt;/textarea&gt;'</span><span style="color:#000000">);</span>
<span style="color:#000000">};</span>
getContacts <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>onFinish<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">var</span> contacts<span style="color:#000000">,</span> o<span style="color:#000000">,</span> i<span style="color:#000000">,</span> c<span style="color:#000000">;</span>

  contacts <span style="color:#000000">=</span> document<span style="color:#000000">.</span><span style="color:#010181">querySelectorAll</span><span style="color:#000000">(</span><span style="color:#ff0000">'.fwb'</span><span style="color:#000000">);</span>
  o <span style="color:#000000">= [];</span>
  <span style="color:#000000; font-weight:bold">for</span><span style="color:#000000">(</span>i <span style="color:#000000">=</span> <span style="color:#2928ff">0</span><span style="color:#000000">;</span> contacts<span style="color:#000000">[</span>i<span style="color:#000000">];</span> i<span style="color:#000000">++) {</span>
    <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>contacts<span style="color:#000000">[</span>i<span style="color:#000000">].</span>classList<span style="color:#000000">.</span><span style="color:#010181">contains</span><span style="color:#000000">(</span><span style="color:#ff0000">'fsl'</span><span style="color:#000000">)) {</span>
      c <span style="color:#000000">= {};</span>
      c<span style="color:#000000">.</span>url <span style="color:#000000">= [</span>contacts<span style="color:#000000">[</span>i<span style="color:#000000">].</span>firstChild<span style="color:#000000">.</span>href<span style="color:#000000">];</span>
      c<span style="color:#000000">.</span>fullName <span style="color:#000000">=</span> contacts<span style="color:#000000">[</span>i<span style="color:#000000">].</span>firstChild<span style="color:#000000">.</span>innerHTML<span style="color:#000000">;</span>
      o<span style="color:#000000">.</span><span style="color:#010181">push</span><span style="color:#000000">(</span>c<span style="color:#000000">);</span>
    <span style="color:#000000">}</span>
  <span style="color:#000000">}</span>
  <span style="color:#010181">onFinish</span><span style="color:#000000">(</span>o<span style="color:#000000">);</span>
<span style="color:#000000">};</span>
<span style="color:#010181">getContacts</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>contacts<span style="color:#000000">) {</span>
  <span style="color:#000000; font-weight:bold">var</span> next<span style="color:#000000">,</span> i<span style="color:#000000">,</span> step<span style="color:#000000">,</span> timeout<span style="color:#000000">;</span>

  i <span style="color:#000000">=</span> <span style="color:#2928ff">0</span><span style="color:#000000">;</span>
  step <span style="color:#000000">=</span> <span style="color:#010181">Number</span><span style="color:#000000">(</span><span style="color:#010181">ask</span><span style="color:#000000">(</span><span style="color:#ff0000">'Please enter an interval (in milliseconds) to wait between each poll for contact data. No less than 200.'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'500'</span><span style="color:#000000">));</span>
  <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>step <span style="color:#000000">&lt;</span> <span style="color:#2928ff">200</span><span style="color:#000000">) {</span>
    step <span style="color:#000000">=</span> <span style="color:#2928ff">200</span><span style="color:#000000">;</span>
  <span style="color:#000000">}</span>
  timeout <span style="color:#000000">=</span> <span style="color:#2928ff">20</span><span style="color:#000000">;</span>

  contacts <span style="color:#000000">=</span> <span style="color:#010181">shuffle</span><span style="color:#000000">(</span>contacts<span style="color:#000000">);</span>
  window<span style="color:#000000">.</span>contacts <span style="color:#000000">=</span> contacts<span style="color:#000000">;</span>
  next <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">() {</span>
    <span style="color:#010181">log</span><span style="color:#000000">(</span>i<span style="color:#000000">,</span> contacts<span style="color:#000000">.</span>length<span style="color:#000000">);</span>
    <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>i <span style="color:#000000">===</span> contacts<span style="color:#000000">.</span>length<span style="color:#000000">) {</span>
      <span style="color:#010181">contactsToCSV</span><span style="color:#000000">(</span>contacts<span style="color:#000000">);</span>
    <span style="color:#000000">}</span> <span style="color:#000000; font-weight:bold">else</span> <span style="color:#000000">{</span>
      <span style="color:#010181">log</span><span style="color:#000000">(</span><span style="color:#ff0000">'extracting'</span><span style="color:#000000">,</span> contacts<span style="color:#000000">[</span>i<span style="color:#000000">].</span>fullName<span style="color:#000000">,</span> contacts<span style="color:#000000">[</span>i<span style="color:#000000">].</span>url<span style="color:#000000">[</span><span style="color:#2928ff">0</span><span style="color:#000000">]);</span>
      IframeSeries<span style="color:#000000">.</span><span style="color:#010181">load</span><span style="color:#000000">(</span>contacts<span style="color:#000000">[</span>i<span style="color:#000000">].</span>url<span style="color:#000000">[</span><span style="color:#2928ff">0</span><span style="color:#000000">] + (</span>contacts<span style="color:#000000">[</span>i<span style="color:#000000">].</span>url<span style="color:#000000">[</span><span style="color:#2928ff">0</span><span style="color:#000000">].</span><span style="color:#010181">indexOf</span><span style="color:#000000">(</span><span style="color:#ff0000">'profile.php'</span><span style="color:#000000">) &lt;</span> <span style="color:#2928ff">0</span> ? <span style="color:#ff0000">'?'</span> <span style="color:#000000">:</span> <span style="color:#ff0000">'&amp;'</span><span style="color:#000000">) +</span> <span style="color:#ff0000">'sk=info'</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">(</span>w<span style="color:#000000">) {</span>
        <span style="color:#000000; font-weight:bold">var</span> j<span style="color:#000000">,</span> poll<span style="color:#000000">;</span>

        j <span style="color:#000000">=</span> <span style="color:#2928ff">0</span><span style="color:#000000">;</span>
        poll <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">() {</span>
          <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span>j <span style="color:#000000">===</span> timeout<span style="color:#000000">) {</span>
            <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#010181">ask</span><span style="color:#000000">(</span><span style="color:#ff0000">'Failing to find data of &quot;'</span> <span style="color:#000000">+</span> contacts<span style="color:#000000">[</span>i<span style="color:#000000">].</span>fullName <span style="color:#000000">+</span> <span style="color:#ff0000">'&quot;. Keep trying?'</span><span style="color:#000000">)) {</span>
              j <span style="color:#000000">=</span> <span style="color:#2928ff">0</span><span style="color:#000000">;</span>
            <span style="color:#000000">}</span> <span style="color:#000000; font-weight:bold">else</span> <span style="color:#000000">{</span>
              <span style="color:#010181">fill</span><span style="color:#000000">(</span>w<span style="color:#000000">,</span> contacts<span style="color:#000000">[</span>i<span style="color:#000000">]);</span>
              i<span style="color:#000000">++;</span>
              <span style="color:#010181">next</span><span style="color:#000000">();</span>
              <span style="color:#000000; font-weight:bold">return</span><span style="color:#000000">;</span>
            <span style="color:#000000">}</span>
          <span style="color:#000000">}</span>
          <span style="color:#010181">setTimeout</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">function</span><span style="color:#000000">() {</span>
            <span style="color:#010181">log</span><span style="color:#000000">(</span><span style="color:#ff0000">'poll'</span><span style="color:#000000">);</span>
            <span style="color:#000000; font-weight:bold">if</span><span style="color:#000000">(</span><span style="color:#010181">ready</span><span style="color:#000000">(</span>w<span style="color:#000000">)) {</span>
              <span style="color:#010181">fill</span><span style="color:#000000">(</span>w<span style="color:#000000">,</span> contacts<span style="color:#000000">[</span>i<span style="color:#000000">]);</span>
              i<span style="color:#000000">++;</span>
              <span style="color:#010181">next</span><span style="color:#000000">();</span>
              <span style="color:#010181">log</span><span style="color:#000000">(</span><span style="color:#ff0000">'extracted'</span><span style="color:#000000">,</span> contacts<span style="color:#000000">[</span>i<span style="color:#000000">]);</span>
            <span style="color:#000000">}</span> <span style="color:#000000; font-weight:bold">else</span> <span style="color:#000000">{</span>
              j<span style="color:#000000">++;</span>
              <span style="color:#010181">poll</span><span style="color:#000000">();</span>
            <span style="color:#000000">}</span>
          <span style="color:#000000">},</span> <span style="color:#010181">bound</span><span style="color:#000000">(</span>step <span style="color:#000000">*</span> Math<span style="color:#000000">.</span><span style="color:#010181">random</span><span style="color:#000000">(),</span> <span style="color:#2928ff">100</span><span style="color:#000000">));</span>
        <span style="color:#000000">};</span>
        <span style="color:#010181">poll</span><span style="color:#000000">();</span>
      <span style="color:#000000">});</span>
    <span style="color:#000000">}</span>
  <span style="color:#000000">};</span>
  <span style="color:#010181">next</span><span style="color:#000000">();</span>
<span style="color:#000000">});</span>
<span style="color:#000000">})()</span>
</pre>
