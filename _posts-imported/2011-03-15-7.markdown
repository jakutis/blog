---
layout: post
title: !binary |-
  QSBQSFAtTXlTUUwgc25pcHBldCB0byBjaGFuZ2UgdGhlIGNoYXJzZXQgYW5k
  IGNvbGxhdGlvbiBvZiBkYXRhYmFzZSwgdGFibGVzIGFuZCBjb2x1bW5z
wordpress_id: 7
wordpress_url: !binary |-
  aHR0cDovL3Z5dGF1dGFzLmpha3V0aXMubmFtZS8/cD03
date: 2011-03-15 18:39:02.000000000 +00:00
---
<pre style="overflow:auto;color:#000000; background-color:khaki; font-size:10pt; font-family:monospace;"><span style="color:#000000">&lt;</span>?php

<span style="color:#000000; font-weight:bold">function</span> <span style="color:#010181">q</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">$text</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">$c</span><span style="color:#000000">) {</span>
    <span style="color:#000000; font-weight:bold">if</span> <span style="color:#000000">(</span><span style="color:#010181">mysql_query</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">$text</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">$c</span><span style="color:#000000">) ===</span> FALSE<span style="color:#000000">) {</span>
        <span style="color:#000000; font-weight:bold">die</span><span style="color:#000000">(</span><span style="color:#ff0000">'failed at: '</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$text</span> <span style="color:#000000">.</span> <span style="color:#ff0000">&quot;</span><span style="color:#ff00ff">\n\n</span><span style="color:#ff0000">&quot;</span> <span style="color:#000000">.</span> <span style="color:#010181">mysql_error</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">$c</span><span style="color:#000000">));</span>
    <span style="color:#000000">}</span>
<span style="color:#000000">}</span>

<span style="color:#000000; font-weight:bold">function</span> <span style="color:#010181">c</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">$hostname</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">$username</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">$password</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">$database</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">$charset</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">$collation</span><span style="color:#000000">) {</span>
    <span style="color:#000000; font-weight:bold">$c</span> <span style="color:#000000">=</span> <span style="color:#010181">mysql_connect</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">$hostname</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">$username</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">$password</span><span style="color:#000000">);</span>
    <span style="color:#010181">mysql_select_db</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">$database</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">$c</span><span style="color:#000000">);</span>
    <span style="color:#000000; font-weight:bold">$qTable</span> <span style="color:#000000">=</span> <span style="color:#010181">mysql_query</span><span style="color:#000000">(</span><span style="color:#ff0000">'SHOW TABLES'</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">$c</span><span style="color:#000000">);</span>
    <span style="color:#000000; font-weight:bold">while</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">$table</span> <span style="color:#000000">=</span> <span style="color:#010181">mysql_fetch_row</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">$qTable</span><span style="color:#000000">)) {</span>
        <span style="color:#000000; font-weight:bold">$table</span> <span style="color:#000000">=</span> <span style="color:#000000; font-weight:bold">$table</span><span style="color:#000000">[</span><span style="color:#2928ff">0</span><span style="color:#000000">];</span>
        <span style="color:#000000; font-weight:bold">$qColumn</span> <span style="color:#000000">=</span> <span style="color:#010181">mysql_query</span><span style="color:#000000">(</span><span style="color:#ff0000">'SHOW FULL COLUMNS FROM `'</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$table</span> <span style="color:#000000">.</span> <span style="color:#ff0000">'`'</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">$c</span><span style="color:#000000">);</span>
        <span style="color:#000000; font-weight:bold">while</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">$column</span> <span style="color:#000000">=</span> <span style="color:#010181">mysql_fetch_assoc</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">$qColumn</span><span style="color:#000000">)) {</span>
            <span style="color:#010181">q</span><span style="color:#000000">(</span><span style="color:#ff0000">'ALTER TABLE `'</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$table</span> <span style="color:#000000">.</span> <span style="color:#ff0000">'` CHANGE `'</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$column</span><span style="color:#000000">[</span><span style="color:#ff0000">'Field'</span><span style="color:#000000">] .</span> <span style="color:#ff0000">'` `'</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$column</span><span style="color:#000000">[</span><span style="color:#ff0000">'Field'</span><span style="color:#000000">] .</span> <span style="color:#ff0000">'` '</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$column</span><span style="color:#000000">[</span><span style="color:#ff0000">'Type'</span><span style="color:#000000">] . (</span><span style="color:#000000; font-weight:bold">$column</span><span style="color:#000000">[</span><span style="color:#ff0000">'Collation'</span><span style="color:#000000">] ===</span> null ? <span style="color:#ff0000">' '</span> <span style="color:#000000">:</span> <span style="color:#ff0000">' CHARACTER SET '</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$charset</span> <span style="color:#000000">.</span> <span style="color:#ff0000">' COLLATE '</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$collation</span> <span style="color:#000000">.</span> <span style="color:#ff0000">' '</span><span style="color:#000000">) . (</span><span style="color:#000000; font-weight:bold">$column</span><span style="color:#000000">[</span><span style="color:#ff0000">'Null'</span><span style="color:#000000">] ===</span> <span style="color:#ff0000">'YES'</span> ? <span style="color:#ff0000">'NULL'</span> <span style="color:#000000">:</span> <span style="color:#ff0000">'NOT NULL'</span><span style="color:#000000">) . (</span><span style="color:#000000; font-weight:bold">$column</span><span style="color:#000000">[</span><span style="color:#ff0000">'Default'</span><span style="color:#000000">] ===</span> null ? <span style="color:#ff0000">''</span> <span style="color:#000000">:</span> <span style="color:#ff0000">' DEFAULT</span> <span style="color:#ff00ff">\'</span><span style="color:#ff0000">'</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$column</span><span style="color:#000000">[</span><span style="color:#ff0000">'Default'</span><span style="color:#000000">] .</span> <span style="color:#ff0000">'</span><span style="color:#ff00ff">\'</span><span style="color:#ff0000">'</span> <span style="color:#000000">) .</span> <span style="color:#ff0000">' '</span> <span style="color:#000000">.</span> <span style="color:#010181">strtoupper</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">$column</span><span style="color:#000000">[</span><span style="color:#ff0000">'Extra'</span><span style="color:#000000">]),</span> <span style="color:#000000; font-weight:bold">$c</span><span style="color:#000000">);</span>
        <span style="color:#000000">}</span>
        <span style="color:#010181">q</span><span style="color:#000000">(</span><span style="color:#ff0000">'ALTER TABLE `'</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$table</span> <span style="color:#000000">.</span> <span style="color:#ff0000">'` DEFAULT CHARACTER SET '</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$charset</span> <span style="color:#000000">.</span> <span style="color:#ff0000">' COLLATE '</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$collation</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">$c</span><span style="color:#000000">);</span>
    <span style="color:#000000">}</span>
    <span style="color:#010181">q</span><span style="color:#000000">(</span><span style="color:#ff0000">'ALTER DATABASE `'</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$database</span> <span style="color:#000000">.</span> <span style="color:#ff0000">'` DEFAULT CHARACTER SET '</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$charset</span> <span style="color:#000000">.</span> <span style="color:#ff0000">' COLLATE '</span> <span style="color:#000000">.</span> <span style="color:#000000; font-weight:bold">$collation</span><span style="color:#000000">,</span> <span style="color:#000000; font-weight:bold">$c</span><span style="color:#000000">);</span>
    <span style="color:#010181">mysql_close</span><span style="color:#000000">(</span><span style="color:#000000; font-weight:bold">$c</span><span style="color:#000000">);</span>
<span style="color:#000000">}</span>

<span style="color:#010181">c</span><span style="color:#000000">(</span><span style="color:#ff0000">'hostname'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'username'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'password'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'databasename'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'utf8'</span><span style="color:#000000">,</span> <span style="color:#ff0000">'utf8_general_ci'</span><span style="color:#000000">);</span>
<span style="color:#000000; font-weight:bold">echo</span> <span style="color:#ff0000">'finished without failure.'</span><span style="color:#000000">;</span>
</pre>
